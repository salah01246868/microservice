<div class="glass-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="margin:0">Gestion des Modèles IA</h2>
        <button class="btn-primary" (click)="refresh()">Rafraîchir</button>
    </div>

    <!-- Formulaire d'Ajout/Edition -->
    <div class="glass-card" style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255,255,255,0.05);">
        <h3 style="margin-top:0">{{ isEditing() ? 'Modifier' : 'Ajouter' }} un Modèle</h3>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 150px;">
                <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem;">Type</label>
                <select [ngModel]="currentModel().type" (ngModelChange)="currentModel().type = $event"
                    style="width: 100%; background: var(--glass-bg); color: white; border: 1px solid var(--glass-border); padding: 0.5rem; border-radius: 8px;">
                    <option value="REGRESSION">Régression</option>
                    <option value="CLASSIFICATION">Classification</option>
                    <option value="DEEP_LEARNING">Deep Learning</option>
                </select>
            </div>
            <div style="flex: 1; min-width: 100px;">
                <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem;">Version</label>
                <input type="text" [ngModel]="currentModel().version" (ngModelChange)="currentModel().version = $event"
                    placeholder="1.0"
                    style="width: 100%; background: var(--glass-bg); color: white; border: 1px solid var(--glass-border); padding: 0.5rem; border-radius: 8px;">
            </div>
            <div style="flex: 1; min-width: 150px;">
                <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem;">Date Apprentissage</label>
                <input type="date" [ngModel]="currentModel().dateApprentissage"
                    (ngModelChange)="currentModel().dateApprentissage = $event"
                    style="width: 100%; background: var(--glass-bg); color: white; border: 1px solid var(--glass-border); padding: 0.5rem; border-radius: 8px;">
            </div>
            <div style="flex: 1; min-width: 120px;">
                <label style="display: block; margin-bottom: 0.5rem; font-size: 0.8rem;">Précision (0-1)</label>
                <input type="number" [ngModel]="currentModel().precision"
                    (ngModelChange)="currentModel().precision = $event" step="0.01" min="0" max="1"
                    style="width: 100%; background: var(--glass-bg); color: white; border: 1px solid var(--glass-border); padding: 0.5rem; border-radius: 8px;">
            </div>
            <div style="display: flex; align-items: flex-end; gap: 0.5rem;">
                <button class="btn-primary" (click)="saveModel()">{{ isEditing() ? 'Enregistrer' : 'Ajouter' }}</button>
                <button *ngIf="isEditing()" class="btn-primary" style="background: rgba(255,255,255,0.1);"
                    (click)="resetForm()">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Liste des Modèles -->
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
        <div *ngFor="let m of models()" class="glass-card" style="padding: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="flex: 1;">
                    <h3 style="color: var(--primary-color); margin-top: 0;">{{m.type}}</h3>
                    <p><strong>Version:</strong> {{m.version}}</p>
                    <p><strong>Date:</strong> {{m.dateApprentissage | date:'mediumDate'}}</p>
                    <p><strong>Précision:</strong>
                        <span
                            style="background: rgba(80, 227, 194, 0.2); color: var(--secondary-color); padding: 0.3rem 0.8rem; border-radius: 20px; font-weight: 600;">
                            {{(m.precision * 100).toFixed(1)}}%
                        </span>
                    </p>
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button class="btn-primary" style="padding: 0.3rem 0.6rem; font-size: 0.7rem; background: #6366f1;"
                        (click)="editModel(m)">Editer</button>
                    <button class="btn-primary" style="padding: 0.3rem 0.6rem; font-size: 0.7rem; background: #ef4444;"
                        (click)="deleteModel(m.id!)">Supprimer</button>
                </div>
            </div>
        </div>

        <div *ngIf="models().length === 0" class="glass-card"
            style="text-align: center; border: 1px dashed var(--glass-border); background: transparent;">
            <p>Aucun modèle trouvé.</p>
        </div>
    </div>
</div>